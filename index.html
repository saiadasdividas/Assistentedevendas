<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma de Vendas e Gest√£o - Embalagens Conceito</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#78350f', // amber-900
                        accent: '#f59e0b', // amber-500
                    }
                }
            }
        };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .admin-only { display: none; }
        .task-item.completed { text-decoration: line-through; opacity: 0.6; }
        .pipeline-list.drag-over { background-color: #fef3c7; border: 2px dashed #f59e0b; }
        .tab-button.active, .role-view-btn.active {
            border-color: #78350f;
            color: #78350f;
            font-weight: 600;
            background-color: #fefce8;
        }
    </style>
</head>
<body class="bg-stone-100 text-stone-800">

    <header class="bg-white/80 backdrop-blur sticky top-0 z-50 shadow">
        <div class="max-w-7xl mx-auto flex items-center justify-between p-4">
            <h1 class="text-2xl font-bold text-primary">Embalagens Conceito</h1>
            <nav class="hidden md:flex space-x-6">
                <a href="#campanhas" class="text-stone-600 hover:text-primary transition">Campanhas</a>
                <a href="#processo-comercial" class="text-stone-600 hover:text-primary transition">Processo</a>
                <a href="#registro-diario" class="text-stone-600 hover:text-primary transition">Registros</a>
                <a href="#painel-operacional" class="text-stone-600 hover:text-primary transition">Operacional</a>
                <a href="#funcoes" class="text-stone-600 hover:text-primary transition">Fun√ß√µes</a>
                <a href="#recursos" class="text-stone-600 hover:text-primary transition">Recursos</a>
            </nav>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-4 sm:p-6 space-y-16">
        <section id="missao" class="text-center space-y-4">
            <h2 class="text-4xl font-bold text-primary">Plataforma de Vendas e Gest√£o</h2>
            <p class="text-lg text-stone-600 max-w-3xl mx-auto">Sua ferramenta di√°ria para registro de atividades, acompanhamento de metas e consulta de materiais na Embalagens Conceito.</p>
        </section>

        <div class="bg-white p-3 rounded-2xl shadow text-center">
            <p class="text-sm font-semibold mb-2 text-primary">Selecione sua Vis√£o:</p>
            <div class="flex-shrink-0 border border-stone-200 rounded-lg p-1 inline-flex">
                <button class="role-view-btn px-4 py-2 text-sm rounded-md" data-role-view="sdr">Vis√£o SDR</button>
                <button class="role-view-btn px-4 py-2 text-sm rounded-md" data-role-view="vendedor">Vis√£o Vendedor</button>
                <button class="role-view-btn active px-4 py-2 text-sm rounded-md" data-role-view="all">Vis√£o Completa</button>
            </div>
        </div>

        <section id="campanhas" class="space-y-6 scroll-mt-20" data-role="all">
            <div class="text-center mb-8">
                <h3 class="text-3xl font-semibold text-primary">Campanhas e Metas Ativas</h3>
                <p class="text-stone-600">Foco da equipe para a semana/m√™s. Consulte aqui as estrat√©gias e metas vigentes.</p>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow space-y-8">
                <div>
                    <h4 class="text-xl font-bold text-accent">üì¢ Campanha Atual</h4>
                    <div id="campaign-display" class="mt-4 p-4 bg-accent/10 rounded-lg border-l-4 border-accent"></div>
                    <div id="admin-campaign-form" class="admin-only mt-4 pt-4 border-t space-y-2">
                        <h5 class="font-bold">Definir Campanha (Admin)</h5>
                        <input id="campaign-title" type="text" placeholder="T√≠tulo da Campanha" class="w-full p-2 border rounded-lg" />
                        <input id="campaign-duration" type="text" placeholder="Dura√ß√£o (ex: 01/07 a 07/07)" class="w-full p-2 border rounded-lg" />
                        <textarea id="campaign-strategy" rows="3" placeholder="Descri√ß√£o da estrat√©gia" class="w-full p-2 border rounded-lg"></textarea>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                            <button id="save-campaign-btn" class="flex-1 bg-primary text-white py-2 rounded-lg hover:bg-primary/90">Salvar</button>
                            <button id="edit-campaign-btn" class="flex-1 bg-stone-500 text-white py-2 rounded-lg hover:bg-stone-600">Editar</button>
                            <button id="delete-campaign-btn" class="bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600">Excluir</button>
                        </div>
                    </div>
                </div>
                <div>
                    <h4 class="text-xl font-bold text-accent">üéØ Metas da Equipe</h4>
                    <div id="goals-display" class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"></div>
                    <div id="admin-goals-form" class="admin-only mt-4 pt-4 border-t space-y-2">
                        <h5 class="font-bold">Definir Metas (Admin)</h5>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                            <input id="goal-vendas" type="number" placeholder="Meta Vendas (R$)" class="w-full p-2 border rounded-lg" />
                            <input id="goal-leads" type="number" placeholder="Meta Leads" class="w-full p-2 border rounded-lg" />
                            <input id="goal-reativacoes" type="number" placeholder="Meta Reativa√ß√µes" class="w-full p-2 border rounded-lg" />
                            <input id="goal-custom" type="text" placeholder="Outra Meta" class="w-full p-2 border rounded-lg" />
                        </div>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                            <button id="save-goals-btn" class="flex-1 bg-primary text-white py-2 rounded-lg hover:bg-primary/90">Salvar</button>
                            <button id="edit-goals-btn" class="flex-1 bg-stone-500 text-white py-2 rounded-lg hover:bg-stone-600">Editar</button>
                            <button id="delete-goals-btn" class="bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600">Excluir</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="processo-comercial" class="space-y-6 scroll-mt-20" data-role="all">
             <div class="text-center mb-8">
                <h3 class="text-3xl font-semibold text-primary">Processo Comercial e Funil de Vendas</h3>
                <p class="text-stone-600">O guia visual do nosso processo de vendas, da prospec√ß√£o ao fechamento.</p>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow space-y-8">
                <div>
                    <h4 class="text-xl font-bold text-accent">üìú Descri√ß√£o do Processo Comercial</h4>
                    <div id="process-display" class="mt-4 p-4 bg-stone-50 rounded-lg text-stone-700 whitespace-pre-wrap"></div>
                    <div id="admin-process-form" class="admin-only mt-4 pt-4 border-t space-y-2">
                        <h5 class="font-bold">Editar Processo (Admin)</h5>
                        <textarea id="process-input" rows="5" placeholder="Descreva o processo comercial da empresa aqui..." class="w-full p-2 border rounded-lg"></textarea>
                        <button id="save-process-btn" class="bg-primary text-white py-2 px-4 rounded-lg hover:bg-primary/90">Salvar Processo</button>
                    </div>
                </div>
                <div>
                    <h4 class="text-xl font-bold text-accent">üöÄ Funil de Vendas Din√¢mico</h4>
                    <div id="custom-funnel-display" class="mt-4 flex flex-wrap items-center justify-center gap-2 p-4 bg-stone-50 rounded-lg"></div>
                     <div id="admin-funnel-form" class="admin-only mt-4 pt-4 border-t space-y-2">
                        <h5 class="font-bold">Construir Funil (Admin)</h5>
                        <div class="flex items-center gap-2">
                            <input id="funnel-stage-input" type="text" placeholder="Nome da nova etapa" class="flex-grow p-2 border rounded-lg" />
                            <button id="add-funnel-stage-btn" class="bg-primary text-white font-semibold py-2 px-4 rounded-lg hover:bg-primary/90">Adicionar Etapa</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="registro-diario" class="bg-white p-6 rounded-2xl shadow space-y-6 scroll-mt-20" data-role="all">
            <div class="flex flex-col sm:flex-row justify-between sm:items-center gap-4">
                <h3 class="text-2xl font-semibold text-primary">Painel de Registros Di√°rios</h3>
                <div class="tabs flex-shrink-0 border border-stone-200 rounded-lg p-1">
                    <button class="tab-button daily-log-tab active px-4 py-2 text-sm rounded-md" data-target="sdr-log-tool" data-role-tab="sdr">üìù SDR</button>
                    <button class="tab-button daily-log-tab px-4 py-2 text-sm rounded-md" data-target="vendedor-log-tool" data-role-tab="vendedor">üìä Vendedor</button>
                </div>
            </div>
            <div id="sdr-log-tool" class="daily-log-content">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-lg font-bold text-amber-900">Registro de Atividades do SDR</h4>
                    <button id="clear-sdr-log-btn" class="admin-only text-xs bg-red-500 text-white font-semibold py-1 px-3 rounded-lg hover:bg-red-600 transition-colors">Limpar Hist√≥rico</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <input type="number" id="sdr-prospeccoes" placeholder="N¬∫ Prospec√ß√µes" class="p-2 border rounded-lg">
                    <input type="number" id="sdr-nutricoes" placeholder="N¬∫ Leads Nutridos" class="p-2 border rounded-lg">
                </div>
                <textarea id="sdr-resumo" placeholder="Resumo das atividades e insights do dia..." rows="3" class="w-full p-2 border rounded-lg mb-4"></textarea>
                <button id="add-sdr-log-btn" class="w-full bg-primary text-white font-semibold py-2 px-4 rounded-lg hover:bg-primary/90">Registrar Atividades</button>
                <hr class="my-6"><h4 class="text-lg font-bold mb-4">Hist√≥rico - SDR</h4>
                <div class="overflow-x-auto"><table class="min-w-full bg-white text-sm"><thead class="bg-stone-100"><tr><th class="py-2 px-4 text-left">Data</th><th class="py-2 px-4 text-left">Prospec√ß√µes</th><th class="py-2 px-4 text-left">Nutridos</th><th class="py-2 px-4 text-left">Resumo</th><th class="py-2 px-4 text-left admin-only">A√ß√µes</th></tr></thead><tbody id="sdr-log-table-body"></tbody></table></div>
            </div>
            <div id="vendedor-log-tool" class="daily-log-content hidden">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-lg font-bold text-amber-900">Registro de Resultados do Vendedor</h4>
                    <button id="clear-vendedor-log-btn" class="admin-only text-xs bg-red-500 text-white font-semibold py-1 px-3 rounded-lg hover:bg-red-600 transition-colors">Limpar Hist√≥rico</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <input type="number" id="vendedor-vendas" placeholder="N¬∫ Vendas Fechadas" class="p-2 border rounded-lg">
                    <input type="number" id="vendedor-conversoes" placeholder="N¬∫ Leads Convertidos" class="p-2 border rounded-lg">
                    <input type="number" id="vendedor-reativacoes" placeholder="N¬∫ Clientes Reativados" class="p-2 border rounded-lg">
                </div>
                <textarea id="vendedor-notas" placeholder="Notas importantes, vendas chave..." rows="3" class="w-full p-2 border rounded-lg mb-4"></textarea>
                <button id="add-vendedor-log-btn" class="w-full bg-primary text-white font-semibold py-2 px-4 rounded-lg hover:bg-primary/90">Registrar Resultados</button>
                <hr class="my-6"><h4 class="text-lg font-bold mb-4">Hist√≥rico - Vendedor</h4>
                <div class="overflow-x-auto"><table class="min-w-full bg-white text-sm"><thead class="bg-stone-100"><tr><th class="py-2 px-4 text-left">Data</th><th class="py-2 px-4 text-left">Vendas</th><th class="py-2 px-4 text-left">Convers√µes</th><th class="py-2 px-4 text-left">Reativa√ß√µes</th><th class="py-2 px-4 text-left">Notas</th><th class="py-2 px-4 text-left admin-only">A√ß√µes</th></tr></thead><tbody id="vendedor-log-table-body"></tbody></table></div>
            </div>
        </section>

        <section id="painel-operacional" class="space-y-6 scroll-mt-20" data-role="all">
            <div class="text-center">
                <h3 class="text-3xl font-semibold text-primary">Painel Operacional Di√°rio</h3>
                <p class="text-stone-600">Tarefas, pipeline, calculadora e intelig√™ncia competitiva.</p>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow space-y-4">
                <div class="tabs border-b border-stone-200">
                    <nav class="-mb-px flex flex-wrap space-x-2" aria-label="Tabs">
                        <button class="tab-button operational-tab active px-3 py-2 text-sm border-b-2" data-target="sdr-task-tool" data-role-tab="sdr">üìã Tarefas</button>
                        <button class="tab-button operational-tab px-3 py-2 text-sm border-b-2" data-target="vendedor-pipeline-tool" data-role-tab="vendedor">üóÇÔ∏è Pipeline</button>
                        <button class="tab-button operational-tab px-3 py-2 text-sm border-b-2" data-target="calculadora-tool" data-role-tab="vendedor">üßÆ Calculadora</button>
                        <button class="tab-button operational-tab px-3 py-2 text-sm border-b-2" data-target="competitor-tool" data-role-tab="all">üì° Concorrentes</button>
                    </nav>
                </div>
                <div id="sdr-task-tool" class="operational-content">
                    <h4 class="text-lg font-bold text-amber-900 mb-4">Lista de Tarefas do Dia (SDR)</h4>
                    <div class="flex gap-4 mb-4"><input type="text" id="new-task-input" placeholder="Adicionar nova tarefa..." class="flex-grow p-2 border rounded-lg"><button id="add-task-btn" class="bg-primary text-white font-semibold py-2 px-4 rounded-lg hover:bg-primary/90">Adicionar</button></div>
                    <div id="task-list" class="space-y-2"></div>
                </div>
                <div id="vendedor-pipeline-tool" class="operational-content hidden">
                    <h4 class="text-lg font-bold text-amber-900 mb-4">Pipeline de Vendas (Kanban)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4"><div class="bg-stone-100 p-4 rounded-lg min-h-[200px] pipeline-list" data-stage="qualificado"><h5 class="font-bold text-center mb-2 pointer-events-none">Qualificado</h5></div><div class="bg-stone-100 p-4 rounded-lg min-h-[200px] pipeline-list" data-stage="proposta"><h5 class="font-bold text-center mb-2 pointer-events-none">Proposta</h5></div><div class="bg-stone-100 p-4 rounded-lg min-h-[200px] pipeline-list" data-stage="negociacao"><h5 class="font-bold text-center mb-2 pointer-events-none">Negocia√ß√£o</h5></div><div class="bg-green-100 p-4 rounded-lg min-h-[200px] pipeline-list" data-stage="fechado"><h5 class="font-bold text-green-800 text-center mb-2 pointer-events-none">Fechado</h5></div><div class="bg-red-100 p-4 rounded-lg min-h-[200px] pipeline-list" data-stage="perdido"><h5 class="font-bold text-red-800 text-center mb-2 pointer-events-none">Perdido</h5></div></div>
                    <div class="mt-4 flex gap-4"><input type="text" id="new-deal-input" placeholder="Nome do novo cliente/lead..." class="flex-grow p-2 border rounded-lg"><button id="add-deal-btn" class="bg-primary text-white font-semibold py-2 px-4 rounded-lg hover:bg-primary/90">Adicionar</button></div>
                </div>
                <div id="calculadora-tool" class="operational-content hidden">
                    <h4 class="text-lg font-bold text-amber-900 mb-4">Calculadora R√°pida de Vendas</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4"><div class="space-y-4"><div><label for="calc-preco" class="font-semibold">Pre√ßo Original (R$)</label><input type="number" id="calc-preco" placeholder="100,00" class="w-full mt-1 p-2 border rounded-lg"></div><div><label for="calc-desconto" class="font-semibold">Desconto (%)</label><input type="number" id="calc-desconto" placeholder="10" class="w-full mt-1 p-2 border rounded-lg"></div></div><div class="p-4 bg-stone-100 rounded-lg flex flex-col justify-center"><div class="text-center"><p class="text-stone-600">Pre√ßo Final:</p><p id="calc-final" class="text-3xl font-bold text-primary">R$ 0,00</p></div></div></div>
                </div>
                <div id="competitor-tool" class="operational-content hidden">
                    <div class="flex justify-between items-center mb-4"><h4 class="text-lg font-bold text-amber-900">Registro de Intelig√™ncia Competitiva</h4><button id="clear-competitor-log-btn" class="admin-only text-xs bg-red-500 text-white font-semibold py-1 px-3 rounded-lg hover:bg-red-600">Limpar</button></div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"><input type="text" id="competitor-name" placeholder="Nome do Concorrente" class="p-2 border rounded-lg"><input type="text" id="competitor-strength" placeholder="Ponto Forte" class="p-2 border rounded-lg"><input type="text" id="competitor-weakness" placeholder="Ponto Fraco" class="p-2 border rounded-lg"></div>
                    <textarea id="competitor-notes" placeholder="Outras observa√ß√µes, pre√ßos..." rows="3" class="w-full p-2 border rounded-lg mb-4"></textarea><button id="add-competitor-btn" class="w-full bg-primary text-white font-semibold py-2 px-4 rounded-lg hover:bg-primary/90">Adicionar</button>
                    <hr class="my-6"><h4 class="text-lg font-bold mb-4">Concorrentes Mapeados</h4>
                    <div class="overflow-x-auto"><table class="min-w-full bg-white text-sm"><thead class="bg-stone-100"><tr><th class="py-2 px-4 text-left">Concorrente</th><th class="py-2 px-4 text-left">Ponto Forte</th><th class="py-2 px-4 text-left">Ponto Fraco</th><th class="py-2 px-4 text-left">Observa√ß√µes</th><th class="py-2 px-4 text-left admin-only">A√ß√µes</th></tr></thead><tbody id="competitor-table-body"></tbody></table></div>
                </div>
            </div>
        </section>

        <section id="funcoes" class="scroll-mt-20" data-role="all">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-2xl shadow space-y-4" data-role-column="sdr"><h3 class="text-2xl font-semibold text-primary">SDR (Sales Development Rep)</h3><p class="text-stone-600">O pr√©-vendedor focado em prospec√ß√£o e qualifica√ß√£o de leads.</p><div id="sdr-tasks-accordion" class="space-y-2"><div class="accordion-item"><button class="accordion-header w-full text-left font-semibold p-3 bg-stone-100 rounded-lg flex justify-between items-center hover:bg-stone-200">Principais Responsabilidades<span class="accordion-icon transform rotate-0 transition-transform text-primary">‚ñº</span></button><div class="accordion-content hidden p-3"><ul class="list-disc list-inside text-stone-600 space-y-1"><li>Prospec√ß√£o Ativa</li><li>Primeiro Contato</li><li>Gest√£o de CRM</li><li>Follow-up</li><li>Qualificar clientes</li></ul></div></div><div class="accordion-item"><button class="accordion-header w-full text-left font-semibold p-3 bg-stone-100 rounded-lg flex justify-between items-center hover:bg-stone-200">Plano Di√°rio de Atividades<span class="accordion-icon transform rotate-0 transition-transform text-primary">‚ñº</span></button><div class="accordion-content hidden p-3"><ul id="sdr-daily-plan" class="list-disc list-inside text-stone-600 space-y-1"></ul><div class="admin-only mt-4 pt-4 border-t"><textarea id="sdr-plan-input" rows="8" class="w-full p-2 border rounded-lg text-sm"></textarea><button id="save-sdr-plan-btn" class="mt-2 bg-primary text-white text-xs font-semibold py-1 px-3 rounded-lg">Salvar Plano</button></div></div></div></div></div>
                <div class="bg-white p-6 rounded-2xl shadow space-y-4" data-role-column="vendedor"><h3 class="text-2xl font-semibold text-primary">Vendedor (Fechador)</h3><p class="text-stone-600">Pega os clientes qualificados e fecha a venda.</p><div id="vendedor-tasks-accordion" class="space-y-2"><div class="accordion-item"><button class="accordion-header w-full text-left font-semibold p-3 bg-stone-100 rounded-lg flex justify-between items-center hover:bg-stone-200">Principais Responsabilidades<span class="accordion-icon transform rotate-0 transition-transform text-primary">‚ñº</span></button><div class="accordion-content hidden p-3"><ul class="list-disc list-inside text-stone-600 space-y-1"><li>Apresentar produtos</li><li>Elaborar propostas</li><li>Negociar pre√ßos</li><li>Fechar a venda</li><li>P√≥s-venda</li></ul></div></div><div class="accordion-item"><button class="accordion-header w-full text-left font-semibold p-3 bg-stone-100 rounded-lg flex justify-between items-center hover:bg-stone-200">Plano Di√°rio de Atividades<span class="accordion-icon transform rotate-0 transition-transform text-primary">‚ñº</span></button><div class="accordion-content hidden p-3"><ul id="vendedor-daily-plan" class="list-disc list-inside text-stone-600 space-y-1"></ul><div class="admin-only mt-4 pt-4 border-t"><textarea id="vendedor-plan-input" rows="6" class="w-full p-2 border rounded-lg text-sm"></textarea><button id="save-vendedor-plan-btn" class="mt-2 bg-primary text-white text-xs font-semibold py-1 px-3 rounded-lg">Salvar Plano</button></div></div></div></div></div>
            </div>
        </section>

        <section id="recursos" class="space-y-4 scroll-mt-20" data-role="all">
            <h3 class="text-3xl font-semibold text-center text-primary">Biblioteca de Recursos</h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <a href="https://www.youtube.com/watch?v=TNcRr1vU_yc" target="_blank" class="block bg-white p-4 rounded-lg shadow hover:shadow-lg transition"><p class="font-semibold text-primary">O Melhor Treinamento de Vendas do Brasil</p><p class="text-sm text-stone-500">ANDR√â ORTIZ</p></a>
                <a href="https://www.youtube.com/watch?v=18XdUKtjdpQ" target="_blank" class="block bg-white p-4 rounded-lg shadow hover:shadow-lg transition"><p class="font-semibold text-primary">Curso de Vendas Completo - 20 M√≥dulos</p><p class="text-sm text-stone-500">Brian Tracy</p></a>
                <a href="https://www.youtube.com/watch?v=bJHh8cS7wW4" target="_blank" class="block bg-white p-4 rounded-lg shadow hover:shadow-lg transition"><p class="font-semibold text-primary">Aula 1 - SPIN Selling 2025</p><p class="text-sm text-stone-500">Guilherme Miranda</p></a>
                <a href="https://www.youtube.com/watch?v=JYHfGVCKtLE" target="_blank" class="block bg-white p-4 rounded-lg shadow hover:shadow-lg transition"><p class="font-semibold text-primary">Aula 2 - Perguntas de Situa√ß√£o</p><p class="text-sm text-stone-500">Guilherme Miranda</p></a>
                <a href="https://www.youtube.com/watch?v=XQIdFxHuuFc" target="_blank" class="block bg-white p-4 rounded-lg shadow hover:shadow-lg transition"><p class="font-semibold text-primary">Aula 3 - Perguntas de Problema</p><p class="text-sm text-stone-500">Guilherme Miranda</p></a>
                <a href="https://www.youtube.com/watch?v=I0OU1AAul7M" target="_blank" class="block bg-white p-4 rounded-lg shadow hover:shadow-lg transition"><p class="font-semibold text-primary">Aula 4 - Perguntas de Implica√ß√£o</p><p class="text-sm text-stone-500">Guilherme Miranda</p></a>
            </div>
        </section>
    </main>

    <footer class="bg-stone-800 text-white py-4 text-center">
        <p>¬© 2025 Embalagens Conceito. Todos os direitos reservados.</p>
        <div id="admin-login-area" class="mt-2"><input id="admin-password" type="password" placeholder="Senha Admin" class="bg-stone-700 p-1 rounded text-xs text-center" /><button id="admin-login-btn" class="bg-accent text-primary font-bold py-1 px-2 rounded text-xs ml-1">Entrar</button><p id="admin-error" class="text-red-400 text-xs hidden mt-1">Senha incorreta.</p></div>
    </footer>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, onSnapshot, deleteDoc, setDoc, updateDoc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase Configuration ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // --- Initialize Firebase ---
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // --- Collections References ---
        const sdrLogCol = collection(db, `artifacts/${appId}/public/data/sdr-logs`);
        const vendedorLogCol = collection(db, `artifacts/${appId}/public/data/vendedor-logs`);
        const tasksCol = collection(db, `artifacts/${appId}/public/data/tasks`);
        const dealsCol = collection(db, `artifacts/${appId}/public/data/deals`);
        const competitorsCol = collection(db, `artifacts/${appId}/public/data/competitors`);
        const settingsCol = collection(db, `artifacts/${appId}/public/data/settings`);
        
        // --- Single Document References ---
        const campaignDoc = doc(settingsCol, 'campaign');
        const goalsDoc = doc(settingsCol, 'goals');
        const processDoc = doc(settingsCol, 'commercialProcess');
        const sdrPlanDoc = doc(settingsCol, 'sdrDailyPlan');
        const vendedorPlanDoc = doc(settingsCol, 'vendedorDailyPlan');
        const funnelDoc = doc(settingsCol, 'customFunnel');

        let isAdmin = false;
        const ADMIN_PASSWORD = 'conceito2024';

        // --- Authentication ---
        onAuthStateChanged(auth, user => {
            if (user) {
                console.log("User is signed in:", user.uid);
                initializeAppLogic();
            } else {
                 console.log("User is signed out. Attempting to sign in.");
                 if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    signInWithCustomToken(auth, __initial_auth_token).catch(error => {
                        console.error("Custom token sign-in failed, trying anonymous:", error);
                        signInAnonymously(auth);
                    });
                } else {
                    signInAnonymously(auth).catch(error => {
                        console.error("Anonymous sign-in failed:", error);
                    });
                }
            }
        });

        function initializeAppLogic() {
            // All functions are defined before being called
            
            // --- Render Functions ---
            function renderSdrLog(logs) {
                const sdrLogTableBody = document.getElementById('sdr-log-table-body');
                sdrLogTableBody.innerHTML = '';
                logs.forEach(entry => {
                    const row = sdrLogTableBody.insertRow();
                    row.className = 'border-b';
                    row.innerHTML = `
                        <td class="py-2 px-4">${new Date(entry.timestamp?.toDate()).toLocaleDateString('pt-BR')}</td>
                        <td class="py-2 px-4">${entry.prospeccoes}</td>
                        <td class="py-2 px-4">${entry.nutricoes}</td>
                        <td class="py-2 px-4">${entry.resumo}</td>
                        <td class="py-2 px-4 admin-only">
                            <button data-id="${entry.id}" class="delete-sdr-log-btn text-red-500 hover:text-red-700">Excluir</button>
                        </td>
                    `;
                });
                if (isAdmin) {
                    document.querySelectorAll('.delete-sdr-log-btn').forEach(btn => btn.parentElement.style.display = 'revert');
                }
            };
            
            function renderVendedorLog(logs) {
                const vendedorLogTableBody = document.getElementById('vendedor-log-table-body');
                vendedorLogTableBody.innerHTML = '';
                logs.forEach(entry => {
                    const row = vendedorLogTableBody.insertRow();
                    row.className = 'border-b';
                    row.innerHTML = `
                        <td class="py-2 px-4">${new Date(entry.timestamp?.toDate()).toLocaleDateString('pt-BR')}</td>
                        <td class="py-2 px-4">${entry.vendas}</td>
                        <td class="py-2 px-4">${entry.conversoes}</td>
                        <td class="py-2 px-4">${entry.reativacoes}</td>
                        <td class="py-2 px-4">${entry.notas}</td>
                        <td class="py-2 px-4 admin-only">
                             <button data-id="${entry.id}" class="delete-vendedor-log-btn text-red-500 hover:text-red-700">Excluir</button>
                        </td>
                    `;
                });
                 if (isAdmin) {
                    document.querySelectorAll('.delete-vendedor-log-btn').forEach(btn => btn.parentElement.style.display = 'revert');
                }
            };
            
            function renderTasks(tasks) {
                const taskListEl = document.getElementById('task-list');
                taskListEl.innerHTML = '';
                tasks.forEach(task => {
                    const taskEl = document.createElement('div');
                    taskEl.className = `task-item flex items-center justify-between p-2 rounded-lg bg-stone-100 ${task.completed ? 'completed' : ''}`;
                    const adminTag = task.createdBy === 'Admin' ? '<span class="text-xs text-accent font-bold ml-2">(Admin)</span>' : '';
                    taskEl.innerHTML = `
                        <div>
                            <span>${task.text}</span>
                            ${adminTag}
                        </div>
                        <div class="flex items-center gap-2">
                            <button data-id="${task.id}" data-completed="${task.completed}" class="toggle-task-btn text-green-600">‚úì</button>
                            <button data-id="${task.id}" class="delete-task-btn text-red-600">‚úó</button>
                        </div>
                    `;
                    taskListEl.appendChild(taskEl);
                });
            };

            function addDragAndDropHandlers() {
                const pipelineLists = document.querySelectorAll('.pipeline-list');
                pipelineLists.forEach(list => {
                    list.addEventListener('dragover', e => { e.preventDefault(); list.classList.add('drag-over'); });
                    list.addEventListener('dragleave', () => list.classList.remove('drag-over'));
                    list.addEventListener('drop', async e => {
                        e.preventDefault();
                        list.classList.remove('drag-over');
                        const docId = e.dataTransfer.getData('text/plain');
                        const newStage = list.dataset.stage;
                        if (docId) await updateDoc(doc(dealsCol, docId), { stage: newStage });
                    });
                });

                document.querySelectorAll('.pipeline-list > div[draggable="true"]').forEach(dealEl => {
                    dealEl.addEventListener('dragstart', e => {
                        if (e.target.closest('.edit-deal-btn') || e.target.closest('.delete-deal-btn')) return e.preventDefault();
                        e.dataTransfer.setData('text/plain', e.target.dataset.id);
                        setTimeout(() => e.target.classList.add('opacity-50'), 0);
                    });
                    dealEl.addEventListener('dragend', e => e.target.classList.remove('opacity-50'));
                });
            };

            function renderDeals(deals) {
                document.querySelectorAll('.pipeline-list').forEach(list => {
                    const title = list.querySelector('h5').outerHTML;
                    list.innerHTML = title;
                });
                deals.forEach(deal => {
                    const dealEl = document.createElement('div');
                    dealEl.className = 'p-2 bg-white rounded shadow text-sm cursor-grab';
                    dealEl.setAttribute('draggable', true);
                    dealEl.dataset.id = deal.id;

                    dealEl.innerHTML = `
                        <div class="flex justify-between items-center">
                            <p class="font-semibold flex-grow">${deal.text}</p>
                            <div class="admin-only flex-shrink-0 ml-2 space-x-1">
                                <button data-id="${deal.id}" data-text="${deal.text}" class="edit-deal-btn text-blue-600 hover:text-blue-800 p-1 text-xs">‚úèÔ∏è</button>
                                <button data-id="${deal.id}" data-text="${deal.text}" class="delete-deal-btn text-red-600 hover:text-red-800 p-1 text-xs">üóëÔ∏è</button>
                            </div>
                        </div>
                    `;
                    document.querySelector(`.pipeline-list[data-stage="${deal.stage}"]`).appendChild(dealEl);
                });
                 addDragAndDropHandlers();
                 if (isAdmin) {
                    document.querySelectorAll('#vendedor-pipeline-tool .admin-only').forEach(el => el.style.display = 'flex');
                 }
            };

            function renderCompetitors(competitors) {
                const competitorTableBody = document.getElementById('competitor-table-body');
                competitorTableBody.innerHTML = '';
                competitors.forEach(comp => {
                    const row = competitorTableBody.insertRow();
                    row.className = 'border-b';
                    row.innerHTML = `
                        <td class="py-2 px-4">${comp.name}</td>
                        <td class="py-2 px-4">${comp.strength}</td>
                        <td class="py-2 px-4">${comp.weakness}</td>
                        <td class="py-2 px-4">${comp.notes}</td>
                        <td class="py-2 px-4 admin-only">
                            <button data-id="${comp.id}" class="delete-competitor-btn text-red-500 hover:text-red-700">Excluir</button>
                        </td>
                    `;
                });
                if (isAdmin) {
                    document.querySelectorAll('.delete-competitor-btn').forEach(btn => btn.parentElement.style.display = 'revert');
                }
            };
            
            function renderCampaign(campaignData) {
                document.getElementById('campaign-display').innerHTML = `
                    <h5 class="font-bold text-lg">${campaignData.title}</h5>
                    <p class="text-sm font-medium text-stone-500 mb-2">${campaignData.duration}</p>
                    <p class="text-stone-700 whitespace-pre-wrap">${campaignData.strategy}</p>
                `;
            };

            function renderGoals(goalsData) {
                document.getElementById('goals-display').innerHTML = `
                    <div class="bg-stone-100 p-4 rounded-lg text-center">
                        <p class="text-sm font-semibold text-stone-600">Vendas (R$)</p>
                        <p class="text-2xl font-bold">${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(goalsData.vendas || 0)}</p>
                    </div>
                     <div class="bg-stone-100 p-4 rounded-lg text-center">
                        <p class="text-sm font-semibold text-stone-600">Leads Qualificados</p>
                        <p class="text-2xl font-bold">${goalsData.leads || 0}</p>
                    </div>
                     <div class="bg-stone-100 p-4 rounded-lg text-center">
                        <p class="text-sm font-semibold text-stone-600">Reativa√ß√µes</p>
                        <p class="text-2xl font-bold">${goalsData.reativacoes || 0}</p>
                    </div>
                     <div class="bg-stone-100 p-4 rounded-lg text-center">
                        <p class="text-sm font-semibold text-stone-600">Foco Adicional</p>
                        <p class="text-xl font-bold">${goalsData.custom || 'N/A'}</p>
                    </div>
                `;
            };
            
            function renderProcess(processText) {
                document.getElementById('process-display').textContent = processText;
                document.getElementById('process-input').value = processText;
            };

            function editFunnelStage(index, stages) {
                const newName = prompt('Editar nome da etapa:', stages[index]);
                if (newName && newName.trim() !== '') {
                    stages[index] = newName.trim();
                    setDoc(funnelDoc, { stages });
                }
            };

            function deleteFunnelStage(index, stages) {
                if(confirm(`Tem certeza que deseja excluir a etapa "${stages[index]}"?`)){
                    stages.splice(index, 1);
                    setDoc(funnelDoc, { stages });
                }
            };

            function renderCustomFunnel(stages) {
                const customFunnelDisplay = document.getElementById('custom-funnel-display');
                customFunnelDisplay.innerHTML = '';
                stages.forEach((stage, index) => {
                    const stageEl = document.createElement('div');
                    stageEl.className = 'flex items-center';
                    const stagePill = document.createElement('div');
                    stagePill.className = 'bg-primary text-white font-semibold py-2 px-4 rounded-full flex items-center gap-2';
                    stagePill.innerHTML = `<span>${stage}</span>`;
                    if (isAdmin) {
                        const editBtn = document.createElement('button');
                        editBtn.innerHTML = '‚úèÔ∏è';
                        editBtn.className = 'text-xs';
                        editBtn.onclick = () => editFunnelStage(index, stages);
                        stagePill.appendChild(editBtn);

                        const deleteBtn = document.createElement('button');
                        deleteBtn.innerHTML = 'üóëÔ∏è';
                        deleteBtn.className = 'text-xs';
                        deleteBtn.onclick = () => deleteFunnelStage(index, stages);
                        stagePill.appendChild(deleteBtn);
                    }
                    stageEl.appendChild(stagePill);
                    if (index < stages.length - 1) {
                        const arrow = document.createElement('span');
                        arrow.className = 'text-primary font-bold text-2xl mx-2';
                        arrow.textContent = '‚Üí';
                        stageEl.appendChild(arrow);
                    }
                    customFunnelDisplay.appendChild(stageEl);
                });
            };

            function renderSdrPlan(plan) {
                document.getElementById('sdr-daily-plan').innerHTML = plan.map(item => `<li>${item}</li>`).join('');
                document.getElementById('sdr-plan-input').value = plan.join('\n');
            };

            function renderVendedorPlan(plan) {
                document.getElementById('vendedor-daily-plan').innerHTML = plan.map(item => `<li>${item}</li>`).join('');
                document.getElementById('vendedor-plan-input').value = plan.join('\n');
            };
            
            function setupAccordions(containerSelector) {
                const container = document.getElementById(containerSelector);
                if(container) {
                    const headers = container.querySelectorAll('.accordion-header');
                    headers.forEach(header => {
                        header.addEventListener('click', (e) => {
                            if(e.target.closest('.admin-only')) return;
                            const content = header.nextElementSibling;
                            const icon = header.querySelector('.accordion-icon');
                            content.classList.toggle('hidden');
                            icon.classList.toggle('rotate-180');
                        });
                    });
                }
            }
            
            function setupTabs(containerSelector, buttonSelector, contentSelector) {
                 const tabsContainer = document.querySelector(containerSelector);
                if (tabsContainer) {
                    const tabButtons = tabsContainer.querySelectorAll(buttonSelector);
                    const tabContents = tabsContainer.querySelectorAll(contentSelector);

                    tabButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const targetId = button.dataset.target;
                            
                            tabButtons.forEach(btn => btn.classList.remove('active'));
                            button.classList.add('active');
                            
                            tabContents.forEach(content => {
                                if (content.id === targetId) {
                                    content.classList.remove('hidden');
                                } else {
                                    content.classList.add('hidden');
                                }
                            });
                        });
                    });
                }
            }

            // --- Event Listeners and Handlers ---
            document.getElementById('add-sdr-log-btn').addEventListener('click', async () => {
                const prospeccoes = document.getElementById('sdr-prospeccoes').value;
                const nutricoes = document.getElementById('sdr-nutricoes').value;
                const resumo = document.getElementById('sdr-resumo').value;
                if (!prospeccoes && !nutricoes && !resumo) return alert('Preencha pelo menos um campo.');
                await addDoc(sdrLogCol, {
                    timestamp: serverTimestamp(),
                    prospeccoes: Number(prospeccoes) || 0,
                    nutricoes: Number(nutricoes) || 0,
                    resumo: resumo || 'N/A'
                });
                document.getElementById('sdr-prospeccoes').value = '';
                document.getElementById('sdr-nutricoes').value = '';
                document.getElementById('sdr-resumo').value = '';
            });

            document.getElementById('sdr-log-table-body').addEventListener('click', async (e) => {
                if (e.target.classList.contains('delete-sdr-log-btn')) {
                    const docId = e.target.dataset.id;
                    if (confirm('Tem certeza?')) await deleteDoc(doc(sdrLogCol, docId));
                }
            });

            document.getElementById('add-vendedor-log-btn').addEventListener('click', async () => {
                const vendas = document.getElementById('vendedor-vendas').value;
                const conversoes = document.getElementById('vendedor-conversoes').value;
                const reativacoes = document.getElementById('vendedor-reativacoes').value;
                const notas = document.getElementById('vendedor-notas').value;
                if (!vendas && !conversoes && !reativacoes && !notas) return alert('Preencha pelo menos um campo.');
                await addDoc(vendedorLogCol, {
                    timestamp: serverTimestamp(),
                    vendas: Number(vendas) || 0,
                    conversoes: Number(conversoes) || 0,
                    reativacoes: Number(reativacoes) || 0,
                    notas: notas || 'N/A'
                });
                document.getElementById('vendedor-vendas').value = '';
                document.getElementById('vendedor-conversoes').value = '';
                document.getElementById('vendedor-reativacoes').value = '';
                document.getElementById('vendedor-notas').value = '';
            });

            document.getElementById('vendedor-log-table-body').addEventListener('click', async (e) => {
                if (e.target.classList.contains('delete-vendedor-log-btn')) {
                    const docId = e.target.dataset.id;
                    if (confirm('Tem certeza?')) await deleteDoc(doc(vendedorLogCol, docId));
                }
            });

            document.getElementById('clear-sdr-log-btn').addEventListener('click', () => {
                if(confirm('ATEN√á√ÉO: Isso apagar√° TODO o hist√≥rico do SDR. Deseja continuar?')) {
                    onSnapshot(sdrLogCol, (snapshot) => snapshot.docs.forEach(doc => deleteDoc(doc.ref)), { once: true });
                }
            });

            document.getElementById('clear-vendedor-log-btn').addEventListener('click', () => {
                if(confirm('ATEN√á√ÉO: Isso apagar√° TODO o hist√≥rico do Vendedor. Deseja continuar?')) {
                    onSnapshot(vendedorLogCol, (snapshot) => snapshot.docs.forEach(doc => deleteDoc(doc.ref)), { once: true });
                }
            });

            document.getElementById('add-task-btn').addEventListener('click', async () => {
                const taskInput = document.getElementById('new-task-input');
                const taskText = taskInput.value.trim();
                if (taskText) {
                    const newTask = { text: taskText, completed: false, timestamp: serverTimestamp() };
                    if (isAdmin) newTask.createdBy = 'Admin';
                    await addDoc(tasksCol, newTask);
                    taskInput.value = '';
                }
            });

            document.getElementById('task-list').addEventListener('click', async (e) => {
                const target = e.target;
                const id = target.dataset.id;
                if (target.classList.contains('toggle-task-btn')) {
                    const isCompleted = target.dataset.completed === 'true';
                    await updateDoc(doc(tasksCol, id), { completed: !isCompleted });
                }
                if (target.classList.contains('delete-task-btn')) {
                    await deleteDoc(doc(tasksCol, id));
                }
            });

            document.getElementById('add-deal-btn').addEventListener('click', async () => {
                const dealInput = document.getElementById('new-deal-input');
                const dealText = dealInput.value.trim();
                if(dealText) {
                    await addDoc(dealsCol, { text: dealText, stage: 'qualificado', timestamp: serverTimestamp() });
                    dealInput.value = '';
                }
            });

            document.getElementById('vendedor-pipeline-tool').addEventListener('click', async (e) => {
                const editBtn = e.target.closest('.edit-deal-btn');
                if (editBtn) {
                    const docId = editBtn.dataset.id;
                    const currentText = editBtn.dataset.text;
                    const newText = prompt('Editar nome do cliente/lead:', currentText);
                    if (newText && newText.trim() !== '') {
                        await updateDoc(doc(dealsCol, docId), { text: newText.trim() });
                    }
                }

                const deleteBtn = e.target.closest('.delete-deal-btn');
                if (deleteBtn) {
                    const docId = deleteBtn.dataset.id;
                    const text = deleteBtn.dataset.text;
                    if (confirm(`Tem certeza que deseja excluir "${text}"?`)) {
                        await deleteDoc(doc(dealsCol, docId));
                    }
                }
            });

            document.getElementById('calc-preco').addEventListener('input', updateCalculator);
            document.getElementById('calc-desconto').addEventListener('input', updateCalculator);
            function updateCalculator() {
                const calcPreco = document.getElementById('calc-preco');
                const calcDesconto = document.getElementById('calc-desconto');
                const calcFinal = document.getElementById('calc-final');
                const preco = parseFloat(calcPreco.value) || 0;
                const desconto = parseFloat(calcDesconto.value) || 0;
                const precoFinal = preco - (preco * (desconto / 100));
                calcFinal.textContent = `R$ ${precoFinal.toFixed(2).replace('.',',')}`;
            }
            
            document.getElementById('save-campaign-btn').addEventListener('click', async () => {
                const campaignData = {
                    title: document.getElementById('campaign-title').value || 'Nenhuma campanha ativa',
                    duration: document.getElementById('campaign-duration').value || '',
                    strategy: document.getElementById('campaign-strategy').value || 'Foco nas atividades di√°rias.'
                };
                await setDoc(campaignDoc, campaignData);
                alert('Campanha salva com sucesso!');
            });
            
            document.getElementById('edit-campaign-btn').addEventListener('click', async () => {
                onSnapshot(campaignDoc, (doc) => {
                    if (doc.exists()) {
                        const data = doc.data();
                        document.getElementById('campaign-title').value = data.title;
                        document.getElementById('campaign-duration').value = data.duration;
                        document.getElementById('campaign-strategy').value = data.strategy;
                        alert('Dados da campanha atual carregados para edi√ß√£o.');
                    }
                }, { once: true });
            });

            document.getElementById('delete-campaign-btn').addEventListener('click', async () => {
                if (confirm('Tem certeza que deseja excluir a campanha atual?')) {
                    await deleteDoc(campaignDoc);
                    alert('Campanha exclu√≠da.');
                }
            });

            document.getElementById('save-goals-btn').addEventListener('click', async () => {
                const goalsData = {
                    vendas: parseFloat(document.getElementById('goal-vendas').value) || 0,
                    leads: parseInt(document.getElementById('goal-leads').value) || 0,
                    reativacoes: parseInt(document.getElementById('goal-reativacoes').value) || 0,
                    custom: document.getElementById('goal-custom').value || 'N/A'
                };
                await setDoc(goalsDoc, goalsData);
                alert('Metas salvas com sucesso!');
            });
            
            document.getElementById('edit-goals-btn').addEventListener('click', () => {
                 onSnapshot(goalsDoc, (doc) => {
                    if (doc.exists()) {
                        const data = doc.data();
                        document.getElementById('goal-vendas').value = data.vendas;
                        document.getElementById('goal-leads').value = data.leads;
                        document.getElementById('goal-reativacoes').value = data.reativacoes;
                        document.getElementById('goal-custom').value = data.custom;
                        alert('Metas atuais carregadas para edi√ß√£o.');
                    }
                 }, { once: true });
            });
            
            document.getElementById('delete-goals-btn').addEventListener('click', async () => {
                 if (confirm('Tem certeza que deseja excluir as metas atuais?')) {
                    await deleteDoc(goalsDoc);
                    alert('Metas exclu√≠das.');
                }
            });

            document.getElementById('add-competitor-btn').addEventListener('click', async () => {
                const name = document.getElementById('competitor-name').value;
                const strength = document.getElementById('competitor-strength').value;
                const weakness = document.getElementById('competitor-weakness').value;
                const notes = document.getElementById('competitor-notes').value;

                if (!name) return alert('O nome do concorrente √© obrigat√≥rio.');
                
                await addDoc(competitorsCol, { name, strength, weakness, notes, timestamp: serverTimestamp() });
                
                document.getElementById('competitor-name').value = '';
                document.getElementById('competitor-strength').value = '';
                document.getElementById('competitor-weakness').value = '';
                document.getElementById('competitor-notes').value = '';
            });

            document.getElementById('competitor-table-body').addEventListener('click', async (e) => {
                if (e.target.classList.contains('delete-competitor-btn')) {
                    const docId = e.target.dataset.id;
                    if (confirm('Tem certeza?')) await deleteDoc(doc(competitorsCol, docId));
                }
            });
            
            document.getElementById('clear-competitor-log-btn').addEventListener('click', () => {
                if(confirm('ATEN√á√ÉO: Isso apagar√° TODO o hist√≥rico de concorrentes. Deseja continuar?')) {
                    onSnapshot(competitorsCol, (snapshot) => snapshot.docs.forEach(doc => deleteDoc(doc.ref)), { once: true });
                }
            });

            // Role View Logic
            const roleViewButtons = document.querySelectorAll('.role-view-btn');
            roleViewButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const view = button.dataset.roleView;
                    
                    roleViewButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    document.querySelectorAll('[data-role]').forEach(section => {
                        if (view === 'all' || section.dataset.role === view || section.dataset.role === 'all') {
                            section.style.display = 'block';
                        } else {
                            section.style.display = 'none';
                        }
                    });

                     document.querySelectorAll('[data-role-column]').forEach(col => {
                        if (view === 'all' || col.dataset.roleColumn === view) {
                            col.style.display = 'block';
                        } else {
                            col.style.display = 'none';
                        }
                    });

                    document.querySelectorAll('[data-role-tab]').forEach(tab => {
                         if (view === 'all' || tab.dataset.roleTab === view || tab.dataset.roleTab === 'all') {
                            tab.style.display = 'inline-block';
                        } else {
                            tab.style.display = 'none';
                        }
                    });

                    // Reset tabs to default view based on role
                    if(view === 'sdr') {
                        document.querySelector('#registro-diario .tabs .tab-button[data-role-tab="sdr"]').click();
                        document.querySelector('#painel-operacional .tabs .tab-button[data-role-tab="sdr"]').click();
                    } else if (view === 'vendedor') {
                        document.querySelector('#registro-diario .tabs .tab-button[data-role-tab="vendedor"]').click();
                        document.querySelector('#painel-operacional .tabs .tab-button[data-role-tab="vendedor"]').click();
                    } else { // 'all' view
                        document.querySelector('#registro-diario .tabs .tab-button').click();
                        document.querySelector('#painel-operacional .tabs .tab-button').click();
                    }
                });
            });

            document.getElementById('save-sdr-plan-btn').addEventListener('click', async () => {
                const newPlan = document.getElementById('sdr-plan-input').value.split('\n').filter(item => item.trim() !== '');
                await setDoc(sdrPlanDoc, { plan: newPlan });
                alert('Plano di√°rio do SDR salvo com sucesso!');
            });
            
            document.getElementById('save-vendedor-plan-btn').addEventListener('click', async () => {
                const newPlan = document.getElementById('vendedor-plan-input').value.split('\n').filter(item => item.trim() !== '');
                await setDoc(vendedorPlanDoc, { plan: newPlan });
                alert('Plano di√°rio do Vendedor salvo com sucesso!');
            });
            
            document.getElementById('add-funnel-stage-btn').addEventListener('click', async () => {
                const funnelStageInput = document.getElementById('funnel-stage-input');
                const stageName = funnelStageInput.value.trim();
                if (stageName) {
                    onSnapshot(funnelDoc, async (doc) => {
                        const stages = doc.exists() ? doc.data().stages : [];
                        stages.push(stageName);
                        await setDoc(funnelDoc, { stages });
                        funnelStageInput.value = '';
                    }, { once: true });
                }
            });

            document.getElementById('save-process-btn').addEventListener('click', async () => {
                await setDoc(processDoc, { text: document.getElementById('process-input').value });
                alert('Processo comercial salvo com sucesso!');
            });

            // Initial render calls
            setupAccordions('sdr-tasks-accordion');
            setupAccordions('vendedor-tasks-accordion');
            setupTabs('#registro-diario', '.daily-log-tab', '.daily-log-content');
            setupTabs('#painel-operacional', '.operational-tab', '.operational-content');
            onSnapshot(sdrLogCol, (snapshot) => renderSdrLog(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))));
            onSnapshot(vendedorLogCol, (snapshot) => renderVendedorLog(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))));
            onSnapshot(tasksCol, (snapshot) => renderTasks(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))));
            onSnapshot(dealsCol, (snapshot) => renderDeals(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))));
            onSnapshot(competitorsCol, (snapshot) => renderCompetitors(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))));
            onSnapshot(campaignDoc, (doc) => renderCampaign(doc.exists() ? doc.data() : defaultCampaign));
            onSnapshot(goalsDoc, (doc) => renderGoals(doc.exists() ? doc.data() : defaultGoals));
            onSnapshot(processDoc, (doc) => renderProcess(doc.exists() ? doc.data().text : 'Nenhum processo definido.'));
            onSnapshot(sdrPlanDoc, (doc) => renderSdrPlan(doc.exists() ? doc.data().plan : defaultSdrPlan));
            onSnapshot(vendedorPlanDoc, (doc) => renderVendedorPlan(doc.exists() ? doc.data().plan : defaultVendedorPlan));
            onSnapshot(funnelDoc, (doc) => renderCustomFunnel(doc.exists() ? doc.data().stages : ['Prospec√ß√£o', 'Qualifica√ß√£o', 'Apresenta√ß√£o', 'Negocia√ß√£o', 'Fechamento']));
        }
    </script>
</body>
</html>
